FROM ubuntu:vivid

RUN echo "deb http://ppa.launchpad.net/terry.guo/gcc-arm-embedded/ubuntu vivid main" >> /etc/apt/sources.list.d/gcc-arm-embedded.list
RUN apt-key adv --keyserver keyserver.ubuntu.com --recv-keys A3421AFB
RUN DEBIAN_FRONTEND=noninteractive apt-get update
RUN DEBIAN_FRONTEND=noninteractive apt-get install -y -q bzip2 curl git make openocd patch gcc-arm-none-eabi && apt-get clean
RUN cd /tmp && curl -O http://energia.nu/files/arm_tools_linux64.tar.bz2
RUN cd /tmp && tar xvjf arm_tools_linux64.tar.bz2 lm4f/bin/cc3200prog lm4f/bin/dll && mv lm4f/bin/* /usr/local/bin
# SDK cannot be downloaded directly (requires registering on the TI site).
# Furthermore, it is distributed as a Windows binary only (boo). So:
# 1) Go to http://www.ti.com/tool/CC3200SDK and download the SDK exe file.
# 2) "Install" the SDK (which just extracts a bunch of files).
#    You don't need Windows for this, Wine will do just fine.
# 3) The default install path is C:\TI\CC3200SDK_X.Y.Z.
#    Take that entire directory and put here.
ADD CC3200SDK_?.?.?/cc3200-sdk /cc3200-sdk
ADD patches /patches
RUN cd /cc3200-sdk/simplelink/include && patch -p 0 < /patches/simplelink.h.patch
RUN cd /cc3200-sdk/simplelink && patch -p 0 < /patches/simplelink_user.h.patch
