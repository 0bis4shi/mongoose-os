<html>
<body>
  <h1>Welcome to Cesanta Office Heater!</h1>

  <p>Temperature is <span id="temp"></span>&deg;C.</p>
  <p>Heater is <span id="status"></span>.</p>
  <form id="f1">
    <input type=submit value="Turn heater on" id="b1">
  </form>
  <hr>
  Heater firmware version: <span id="fw"></span>

  <script>
    function ajax(url, callback) {
      var httpRequest = new XMLHttpRequest();
      httpRequest.onreadystatechange = function() {
        if (httpRequest.readyState === 4) {
          if (httpRequest.status === 200 || httpRequest.status === 0) {
            try {
              var data = JSON.parse(httpRequest.responseText);
              if (callback) callback(data);
            } catch(e) {
              console.error('Unable to parse JSON', e);
            }
          }
        }
      };
      httpRequest.open('POST', url);
      httpRequest.send();
    }
    var el = function(id) { return document.getElementById(id); };
    var text = function(id, text) { el(id).innerHTML = text; };

    ajax('/status', function(json) {
      text('status', json.on ? 'on' : 'off');
      el('f1').setAttribute('action', json.on ? 'off' : 'on');
      el('b1').setAttribute('value', 'Turn heater ' + (json.on ? 'off' : 'on'));
    });

    ajax('/rpc/Vars.Get', function(json) {
      text('fw', json.fw_id);
    });
  </script>

</body>
</html>
