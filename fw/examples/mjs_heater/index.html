<html>
<body>
  <h1>Welcome to Cesanta Office Heater!</h1>

  <p>Temperature is <b id="temp"></b>&deg;C.</p>
  <p>Heater is <b id="status"></b>.</p>
  <form id="f1">
    <input type=submit value="Turn heater on" id="b1">
  </form>
  <hr>
  Device information: <pre id="fw"></pre>

  <script>
    function ajax(url, callback) {
      var httpRequest = new XMLHttpRequest();
      httpRequest.onreadystatechange = function() {
        if (httpRequest.readyState === 4) {
          if (httpRequest.status === 200 || httpRequest.status === 0) {
            try {
              var data = JSON.parse(httpRequest.responseText);
              if (callback) callback(data);
            } catch(e) {
              console.error('Unable to parse JSON', e);
            }
          }
        }
      };
      httpRequest.open('GET', url);
      httpRequest.send();
    }
    var el = function(id) { return document.getElementById(id); };
    var text = function(id, text) { el(id).innerHTML = text; };

    ajax('/heater/status', function(json) {
      text('status', json.on ? 'on' : 'off');
      text('temp', json.temp);
      el('f1').setAttribute('action', json.on ? '/heater/off' : '/heater/on');
      el('b1').setAttribute('value', 'Turn heater ' + (json.on ? 'off' : 'on'));
    });

    ajax('/rpc/Sys.GetInfo', function(json) {
      text('fw', JSON.stringify(json, null, '  '));
    });
  </script>

</body>
</html>
